===============================================================================
Ranking Analysis
===============================================================================
Purpose:
    - To rank items (e.g., products, customers) based on performance or other metrics.
    - To identify top performers or laggards.
===============================================================================
*/

-- Which 5 products Generating the Highest Revenue?
-- Simple Ranking

select product_name,
  sum(sales_amount) as total_revenue
from gold.fact_sales f 
join gold.dim_products p
 on f.product_key=p.product_key
group by product_name
order by sum(sales_amount) desc limit 5; 

-- Complex but Flexibly Ranking Using Window Functions
with duplicate_cte as (
select product_name,
  sum(sales_amount) as total_sales
from gold.fact_sales f 
join gold.dim_products p
 on f.product_key=p.product_key
group by product_name
)
select product_name, 
 total_sales,
 rank() over(order by total_sales desc) as revenue_ranking
 from duplicate_cte;
 
 -- What are the 5 worst-performing products in terms of sales?
select product_name,
  sum(sales_amount) as total_sales
from gold.fact_sales f 
join gold.dim_products p
 on f.product_key=p.product_key
group by product_name
order by sum(sales_amount) asc 
limit 5; 

-- Find the top 10 customers who have generated the highest revenue
select first_name,
	last_name,
    sum(sales_amount) as total_spending
from gold.fact_sales f 
join gold.dim_customers c
 on f.customer_key=c.customer_key
group by first_name, last_name
order by sum(sales_amount) desc 
limit 10; 

-- The 3 customers with the fewest orders placed
select c.customer_key,
	first_name,
	last_name,
    count(order_number) as total_order
from gold.fact_sales f 
join gold.dim_customers c
 on f.customer_key=c.customer_key
group by c.customer_key, first_name, last_name
order by count(order_number) asc
limit 3;
